"use strict";(globalThis.webpackChunkmimic_docs=globalThis.webpackChunkmimic_docs||[]).push([[836],{3203:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"api/reflection","title":"ReflectionHelper","description":"ReflectionHelper provides convenient methods for working with reflection in C#. Used internally by other APIs to access private fields and methods of the game.","source":"@site/docs/api/reflection.md","sourceDirName":"api","slug":"/api/reflection","permalink":"/MimicAPI/docs/api/reflection","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ServerNetworkAPI","permalink":"/MimicAPI/docs/api/server-network"}}');var r=l(4848),i=l(8453);const a={},s="ReflectionHelper",o={},c=[{value:"Field Methods",id:"field-methods",level:2},{value:"GetFieldValue()",id:"getfieldvalue",level:3},{value:"GetFieldValue&lt;T&gt;()",id:"getfieldvaluet",level:3},{value:"SetFieldValue()",id:"setfieldvalue",level:3},{value:"Method Methods",id:"method-methods",level:2},{value:"InvokeMethod()",id:"invokemethod",level:3},{value:"InvokeMethod&lt;T&gt;()",id:"invokemethodt",level:3},{value:"Property Methods",id:"property-methods",level:2},{value:"GetProperty()",id:"getproperty",level:3},{value:"GetPropertyValue()",id:"getpropertyvalue",level:3},{value:"GetPropertyValue&lt;T&gt;()",id:"getpropertyvaluet",level:3},{value:"SetPropertyValue()",id:"setpropertyvalue",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Inspect Object Structure",id:"inspect-object-structure",level:3},{value:"Safe Get Field Value with Fallback",id:"safe-get-field-value-with-fallback",level:3},{value:"Method Invocation with Error Handling",id:"method-invocation-with-error-handling",level:3},{value:"Create a Wrapper for Private API",id:"create-a-wrapper-for-private-api",level:3},{value:"Cache FieldInfo for Performance",id:"cache-fieldinfo-for-performance",level:3},{value:"Notes",id:"notes",level:2},{value:"Performance",id:"performance",level:2},{value:"Alternatives",id:"alternatives",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"reflectionhelper",children:"ReflectionHelper"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ReflectionHelper"})," provides convenient methods for working with reflection in C#. Used internally by other APIs to access private fields and methods of the game."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"ReflectionHelper is a utility class that simplifies working with private members of game classes. Most other API methods already use it internally."})}),"\n",(0,r.jsx)(n.h2,{id:"field-methods",children:"Field Methods"}),"\n",(0,r.jsx)(n.h3,{id:"getfieldvalue",children:"GetFieldValue()"}),"\n",(0,r.jsx)(n.p,{children:"Gets the value of an object's field."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static object? GetFieldValue(object target, string fieldName)\npublic static object? GetFieldValue(Type type, string fieldName)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'var hub = CoreAPI.GetHub();\nif (hub != null)\n{\n    var vworld = ReflectionHelper.GetFieldValue(hub, "vworld");\n    MelonLogger.Msg($"VWorld retrieved: {vworld != null}");\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"getfieldvaluet",children:"GetFieldValue<T>()"}),"\n",(0,r.jsx)(n.p,{children:"Gets a typed field value."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static T GetFieldValue<T>(object target, string fieldName)\npublic static T GetFieldValue<T>(Type type, string fieldName)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'var hub = CoreAPI.GetHub();\nif (hub != null)\n{\n    var vworld = ReflectionHelper.GetFieldValue<VWorld>(hub, "vworld");\n    if (vworld != null)\n    {\n        MelonLogger.Msg("VWorld successfully retrieved with type");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"setfieldvalue",children:"SetFieldValue()"}),"\n",(0,r.jsx)(n.p,{children:"Sets the value of an object's field."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static void SetFieldValue(object target, string fieldName, object value)\npublic static void SetFieldValue(Type type, string fieldName, object value)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'var room = RoomAPI.GetCurrentRoom();\nif (room != null)\n{\n    // Change maximum player count\n    ReflectionHelper.SetFieldValue(room, "_maxPlayers", 16);\n    MelonLogger.Msg("Maximum players changed");\n}\n'})}),"\n",(0,r.jsx)(n.admonition,{title:"Caution",type:"warning",children:(0,r.jsx)(n.p,{children:"Directly changing fields can break the game's internal logic. Use with caution."})}),"\n",(0,r.jsx)(n.h2,{id:"method-methods",children:"Method Methods"}),"\n",(0,r.jsx)(n.h3,{id:"invokemethod",children:"InvokeMethod()"}),"\n",(0,r.jsx)(n.p,{children:"Invokes an object's method."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static object? InvokeMethod(object target, string methodName, params object[] parameters)\npublic static object? InvokeMethod(Type type, string methodName, params object[] parameters)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'var room = RoomAPI.GetCurrentRoom();\nif (room != null)\n{\n    var result = ReflectionHelper.InvokeMethod(room, "IsPlayable");\n    if (result is bool isPlayable)\n    {\n        MelonLogger.Msg($"Room is playable: {isPlayable}");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"With parameters:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'var waitingRoom = ServerNetworkAPI.GetWaitingRoom();\nif (waitingRoom != null)\n{\n    long playerUid = 12345;\n    var result = ReflectionHelper.InvokeMethod(waitingRoom, "CanEnterChannel", playerUid);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"invokemethodt",children:"InvokeMethod<T>()"}),"\n",(0,r.jsx)(n.p,{children:"Invokes a method with a typed return value."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static T? InvokeMethod<T>(object target, string methodName, params object[] parameters) where T : class\npublic static T? InvokeMethod<T>(Type type, string methodName, params object[] parameters) where T : class\n"})}),"\n",(0,r.jsx)(n.h2,{id:"property-methods",children:"Property Methods"}),"\n",(0,r.jsx)(n.h3,{id:"getproperty",children:"GetProperty()"}),"\n",(0,r.jsx)(n.p,{children:"Gets PropertyInfo for a property."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static PropertyInfo? GetProperty(Type type, string propertyName)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"getpropertyvalue",children:"GetPropertyValue()"}),"\n",(0,r.jsx)(n.p,{children:"Gets a property value."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static object? GetPropertyValue(object target, string propertyName)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"getpropertyvaluet",children:"GetPropertyValue<T>()"}),"\n",(0,r.jsx)(n.p,{children:"Gets a typed property value."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static T GetPropertyValue<T>(object target, string propertyName)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"setpropertyvalue",children:"SetPropertyValue()"}),"\n",(0,r.jsx)(n.p,{children:"Sets a property value."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public static void SetPropertyValue(object target, string propertyName, object value)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,r.jsx)(n.h3,{id:"inspect-object-structure",children:"Inspect Object Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'void InspectObject(object obj)\n{\n    if (obj == null) return;\n\n    Type type = obj.GetType();\n    MelonLogger.Msg($"=== Inspecting: {type.Name} ===");\n\n    // Get all fields\n    var fields = type.GetFields(\n        BindingFlags.Public | \n        BindingFlags.NonPublic | \n        BindingFlags.Instance\n    );\n\n    MelonLogger.Msg($"Fields: {fields.Length}");\n    foreach (var field in fields.Take(10))\n    {\n        var value = ReflectionHelper.GetFieldValue(obj, field.Name);\n        MelonLogger.Msg($"- {field.Name}: {value}");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"safe-get-field-value-with-fallback",children:"Safe Get Field Value with Fallback"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'T SafeGetFieldValue<T>(object target, string fieldName, T defaultValue = default)\n{\n    try\n    {\n        var value = ReflectionHelper.GetFieldValue<T>(target, fieldName);\n        return value ?? defaultValue;\n    }\n    catch (Exception ex)\n    {\n        MelonLogger.Warning($"Failed to get field {fieldName}: {ex.Message}");\n        return defaultValue;\n    }\n}\n\n// Usage\nvar maxPlayers = SafeGetFieldValue(room, "_maxPlayers", 4);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"method-invocation-with-error-handling",children:"Method Invocation with Error Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'bool TryInvokeMethod(\n    object target, \n    string methodName, \n    out object? result,\n    params object[] parameters\n)\n{\n    try\n    {\n        result = ReflectionHelper.InvokeMethod(target, methodName, parameters);\n        return true;\n    }\n    catch (Exception ex)\n    {\n        MelonLogger.Error($"Error calling {methodName}: {ex.Message}");\n        result = null;\n        return false;\n    }\n}\n\n// Usage\nif (TryInvokeMethod(room, "IsPlayable", out var result))\n{\n    if (result is bool isPlayable)\n    {\n        MelonLogger.Msg($"Result: {isPlayable}");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"create-a-wrapper-for-private-api",children:"Create a Wrapper for Private API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'class InventoryWrapper\n{\n    private object inventory;\n\n    public InventoryWrapper(object inv)\n    {\n        inventory = inv;\n    }\n\n    public List<InventoryItem> GetItems()\n    {\n        return ReflectionHelper.GetFieldValue<List<InventoryItem>>(\n            inventory, \n            "SlotItems"\n        ) ?? new List<InventoryItem>();\n    }\n\n    public int GetMaxSlots()\n    {\n        return ReflectionHelper.GetFieldValue<int>(inventory, "maxSlots");\n    }\n\n    public bool AddItem(InventoryItem item)\n    {\n        var result = ReflectionHelper.InvokeMethod(inventory, "AddItem", item);\n        return result is bool success && success;\n    }\n}\n\n// Usage\nvar player = PlayerAPI.GetLocalPlayer();\nvar inventoryObj = ReflectionHelper.GetFieldValue(player, "inventory");\nvar inventory = new InventoryWrapper(inventoryObj);\n\nvar items = inventory.GetItems();\nint maxSlots = inventory.GetMaxSlots();\n'})}),"\n",(0,r.jsx)(n.h3,{id:"cache-fieldinfo-for-performance",children:"Cache FieldInfo for Performance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'class CachedReflection\n{\n    private static Dictionary<string, FieldInfo> fieldCache = new Dictionary<string, FieldInfo>();\n\n    public static object? GetCachedFieldValue(object target, string fieldName)\n    {\n        string key = $"{target.GetType().FullName}.{fieldName}";\n\n        if (!fieldCache.TryGetValue(key, out var fieldInfo))\n        {\n            fieldInfo = target.GetType().GetField(\n                fieldName,\n                BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.Public\n            );\n            \n            if (fieldInfo != null)\n            {\n                fieldCache[key] = fieldInfo;\n            }\n        }\n\n        return fieldInfo?.GetValue(target);\n    }\n\n    public static void ClearCache()\n    {\n        fieldCache.Clear();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsx)(n.admonition,{title:"Important",type:"warning",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reflection is slower than direct access"}),"\n",(0,r.jsx)(n.li,{children:"Field and method names may change in game updates"}),"\n",(0,r.jsx)(n.li,{children:"Always handle exceptions when working with reflection"}),"\n"]})}),"\n",(0,r.jsx)(n.admonition,{title:"Security",type:"danger",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Don't change critical game fields without understanding consequences"}),"\n",(0,r.jsx)(n.li,{children:"Some changes may lead to crashes or break game logic"}),"\n",(0,r.jsx)(n.li,{children:"Use changes only for local testing or with player consent"}),"\n"]})}),"\n",(0,r.jsx)(n.admonition,{title:"Tips",type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cache FieldInfo and MethodInfo for performance"}),"\n",(0,r.jsx)(n.li,{children:"Use try-catch blocks for error handling"}),"\n",(0,r.jsx)(n.li,{children:"Create wrappers for convenient private API access"}),"\n",(0,r.jsx)(n.li,{children:"Document used private members for future updates"}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,r.jsx)(n.p,{children:"Performance comparison:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Operation"}),(0,r.jsx)(n.th,{children:"Direct Access"}),(0,r.jsx)(n.th,{children:"Reflection"}),(0,r.jsx)(n.th,{children:"Cached Reflection"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Field read"}),(0,r.jsx)(n.td,{children:"1x"}),(0,r.jsx)(n.td,{children:"~100x"}),(0,r.jsx)(n.td,{children:"~10x"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Method call"}),(0,r.jsx)(n.td,{children:"1x"}),(0,r.jsx)(n.td,{children:"~50x"}),(0,r.jsx)(n.td,{children:"~5x"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Recommendations:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cache FieldInfo/MethodInfo for frequent access"}),"\n",(0,r.jsx)(n.li,{children:"Avoid reflection in Update() without caching"}),"\n",(0,r.jsx)(n.li,{children:"Use reflection only when no alternatives exist"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"alternatives",children:"Alternatives"}),"\n",(0,r.jsx)(n.p,{children:"Instead of ReflectionHelper consider:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Harmony"})," - for method patching"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Public APIs"})," - if available"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Events"})," - for subscribing to events"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/MimicAPI/docs/api/core",children:"CoreAPI"})," - ReflectionHelper usage examples"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/MimicAPI/docs/api/room",children:"RoomAPI"})," - Private field access examples"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/MimicAPI/docs/api/server-network",children:"ServerNetworkAPI"})," - Advanced reflection work"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>a,x:()=>s});var t=l(6540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);